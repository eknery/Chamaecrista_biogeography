phylo.heatmap(anoletree,anole.resids)
states_num
anole.resids
as.matrix(state_num)
as.matrix(states_num)
states_num = c()
for(i in 1:ncol(states_bin)){
one_col = as.numeric(states_bin[,i])
one_col[one_col == 1] = i
states_num = cbind(states_num, one_col)
}
states_num
row.names(states_num)
row.names(states_bin)
### creating numeric matrix
states_num = c()
for(i in 1:ncol(states_bin)){
one_col = as.numeric(states_bin[,i])
one_col[one_col == 1] = i
states_num = cbind(states_num, one_col)
}
### naminng
row.names(states_num) = row.names(states_bin)
phylo.heatmap(tr,
X=states_num,
fsize=c(0.3,0.75,0.5),
colors=color_vec,
split= c(0.8,0.2),
standardize=F)
color_vec = c(
"white"
"darkgreen",
color_vec = c(
"white",
"darkgreen",
"darkorange",
"darkgoldenrod",
"brown",
"darkblue",
"darkmagenta",
"deeppink",
"darkgray"
)
phylo.heatmap(tr,
X=states_num,
fsize=c(0.3,0.75,0.5),
colors=color_vec,
split= c(0.8,0.2),
standardize=F)
col.names(sate_bin)
colnames(sate_bin)
colnames(state_bin)
colnames(states_bin)
colnames(state_num) = colnames(states_bin)
colnames(states_num) = colnames(states_bin)
phylo.heatmap(tr,
X=states_num,
fsize=c(0.3,0.75,0.5),
colors=color_vec,
split= c(0.8,0.2),
standardize=F)
color_vec = c(
"lightgray",
"darkgreen",
"darkorange",
"darkgoldenrod",
"brown",
"darkblue",
"darkmagenta",
"deeppink",
"darkgray"
)
phylo.heatmap(tr,
X=states_num,
fsize=c(0.3,0.75,0.5),
colors=color_vec,
split= c(0.8,0.2),
standardize=F)
color_vec = c(
"gray80",
"darkgreen",
"darkorange",
"darkgoldenrod",
"brown",
"darkblue",
"darkmagenta",
"deeppink",
"darkgray"
)
phylo.heatmap(tr,
X=states_num,
fsize=c(0.3,0.75,0.5),
colors=color_vec,
split= c(0.8,0.2),
standardize=F)
color_vec = c(
"gray90",
"darkgreen",
"darkorange",
"darkgoldenrod",
"brown",
"darkblue",
"darkmagenta",
"deeppink",
"darkgray"
)
phylo.heatmap(tr,
X=states_num,
fsize=c(0.3,0.75,0.5),
colors=color_vec,
split= c(0.8,0.2),
standardize=F)
phylo.heatmap(tr,
X=states_num,
fsize=c(0.3,0.75,0.5),
colors=color_vec,
split= c(0.9,0.1),
standardize=F)
color_vec = c(
"gray90",
"darkgreen",
"darkorange",
"darkgoldenrod",
"brown",
"darkblue",
"darkmagenta",
"deeppink",
"black"
)
phylo.heatmap(tr,
X=states_num,
fsize=c(0.3,0.75,0.5),
colors=color_vec,
split= c(0.9,0.1),
standardize=F)
res$ML_marginal_prob_each_state_at_branch_top_AT_node
### libraries
library("ape")
library("rexpokit")
library("cladoRcpp")
library("BioGeoBEARS")
### phylogenetic tree location
trfn = "5_posterior/mcc.tree"
tr = read.tree(file = trfn)
### reading range data
geog_fn = ("6_biogeo_data/macro_biogeo.data")
moref(geog_fn)
### converting phylip format to tipranges
tipranges = getranges_from_LagrangePHYLIP(lgdata_fn=geog_fn)
tipranges
### setting maximum number of areas occupied for reconstructions
max_range_size = max(rowSums(dfnums_to_numeric(tipranges@df)))
### time strata and dispersal matrices
timesfn = "6_biogeo_data/model1_times.txt"
areas_allowed_fn = "6_biogeo_data/model2_areas_allowed.txt"
dispersal_multipliers_fn = "6_biogeo_data/model2_dispersal_multi.txt"
### Initialize DEC model
dec2 = define_BioGeoBEARS_run()
### inputting tree into DEC
dec2$trfn = trfn
### location of the geography text file
dec2$geogfn = geogfn
### phylogenetic tree location
trfn = "5_posterior/mcc_chamaecrista.tree"
tr = read.tree(file = trfn)
### reading range data
geogfn = "6_biogeo_data/micro_biogeo.data"
moref(geogfn)
### converting phylip format to tipranges
tipranges = getranges_from_LagrangePHYLIP(lgdata_fn= geogfn)
tipranges
### setting maximum number of areas occupied for reconstructions
max_range_size = max(rowSums(dfnums_to_numeric(tipranges@df)))
### time strata and dispersal matrices
timesfn = "6_biogeo_data/model1_times.txt"
areas_allowed_fn = "6_biogeo_data/model2_areas_allowed.txt"
dispersal_multipliers_fn = "6_biogeo_data/model2_dispersal_multi.txt"
### Initialize DEC model
dec2 = define_BioGeoBEARS_run()
### inputting tree into DEC
dec2$trfn = trfn
### location of the geography text file
dec2$geogfn = geogfn
### Input the maximum range size
dec2$max_range_size = max_range_size
### Min to treat tip as a direct ancestor (no speciation event)
dec2$min_branchlength = 0.001
### set to FALSE for e.g. DEC* model, DEC*+J, etc.
dec2$include_null_range = FALSE
### input time strata and dispersal matrices
dec2$timesfn = timesfn
dec2$areas_allowed_fn = areas_allowed_fn
dec2$dispersal_multipliers_fn = dispersal_multipliers_fn
### loads the dispersal multiplier matrix
dec2 = readfiles_BioGeoBEARS_run(dec2)
### Divide the tree up by time periods
dec2 = section_the_tree(inputs=dec2,
make_master_table=TRUE,
plot_pieces=FALSE,
fossils_older_than=0.001,
cut_fossils=FALSE)
### Decribe stratified table:
dec2$master_table
### default settings to get ancestral states
dec2$return_condlikes_table = TRUE
dec2$calc_TTL_loglike_from_condlikes_table = TRUE
dec2$calc_ancprobs = TRUE    # get ancestral states from optim run
### computing options
dec2$num_cores_to_use = 1
### fitting DEC !
res_dec2 = bears_optim_run(dec2)
### save fitted model
save(res_dec2, file="7_biogeo_results/micro_DEC_2.Rdata")
###  biogeobears scripts
scriptdir = np(system.file("extdata/a_scripts", package="BioGeoBEARS"))
### plotting
res_plot = plot_BioGeoBEARS_results(results_object= res_dec2,
addl_params=list("j"),
plotwhat="text",
label.offset=0.7,
tipcex=0.15,
statecex=0.4,
titlecex=0.8,
plotsplits= F,
cornercoords_loc= scriptdir,
include_null_range= F,
tr=tr,
tipranges=tipranges,
plotlegend = F)
### plotting
res_plot = plot_BioGeoBEARS_results(results_object= res_dec2,
addl_params=list("j"),
plotwhat="text",
label.offset=0.7,
tipcex=0.15,
statecex=0.4,
titlecex=0.8,
plotsplits= F,
cornercoords_loc= scriptdir,
include_null_range= F,
tr=tr,
tipranges=tipranges,
plotlegend = F)
### empty tables to hold the statistical results
restable = NULL
teststable = NULL
load("micro_DEC_0.RData")
load("micro_DEC_1.RData")
load("7_biogeo_resutls/micro_DEC_0.RData")
load("7_biogeo_results/micro_DEC_0.RData")
load("7_biogeo_results/micro_DEC_1.RData")
### empty tables to hold the statistical results
restable = NULL
teststable = NULL
LnL_0 = get_LnL_from_BioGeoBEARS_results_object(res_dec0)
LnL_1 = get_LnL_from_BioGeoBEARS_results_object(res_dec1)
LnL_1 = get_LnL_from_BioGeoBEARS_results_object(res_dec2)
LnL_2 = get_LnL_from_BioGeoBEARS_results_object(res_dec2)
LnL_0 = get_LnL_from_BioGeoBEARS_results_object(res_dec0)
LnL_1 = get_LnL_from_BioGeoBEARS_results_object(res_dec1)
LnL_2 = get_LnL_from_BioGeoBEARS_results_object(res_dec2)
LnL_0
LnL_1
LnL_2
extract_params_from_BioGeoBEARS_results_object(results_object=res_dec0,
returnwhat="table",
addl_params=c("j"),
paramsstr_digits=4)
extract_params_from_BioGeoBEARS_results_object(results_object=res_dec1,
returnwhat="table",
addl_params=c("j"),
paramsstr_digits=4)
### parameter values
param0 = extract_params_from_BioGeoBEARS_results_object(
results_object= res_dec0,
returnwhat= "table",
addl_params= c("j"),
paramsstr_digits= 4
)
param1 = extract_params_from_BioGeoBEARS_results_object(
results_object= res_dec1,
returnwhat= "table",
addl_params= c("j"),
paramsstr_digits= 4
)
param2 = extract_params_from_BioGeoBEARS_results_object(
results_object= res_dec2,
returnwhat= "table",
addl_params= c("j"),
paramsstr_digits= 4
)
source("0_scripts/calculate_aicc.R")
source("0_scripts/function_calculate_aicc.R")
param2
### likelihood
lnl0 = get_LnL_from_BioGeoBEARS_results_object(res_dec0)
lnl1 = get_LnL_from_BioGeoBEARS_results_object(res_dec1)
lnl2 = get_LnL_from_BioGeoBEARS_results_object(res_dec2)
calc_AIC_vals(LnL_vals = c(lnl0, lnl1,lnl2)
nparam_vals = c(2,2,2))
calc_AIC_vals(LnL_vals = c(lnl0, lnl1,lnl2),
nparam_vals = c(2,2,2))
calc_AIC_vals(LnL_vals = c(lnl0, lnl1,lnl2),
nparam_vals = c(2,2,2),
samplesize = 281)
calc_AIC_vals(LnL_vals = c(lnl0, lnl1,lnl2),
nparam_vals = c(2,2,2),
samplesize = c(281)
)
calc_AIC_vals(LnL_vals = c(lnl0, lnl1,lnl2),
nparam_vals = c(2,2,2)
)
### load libraries
if(!require("tidyverse")) install.packages("tidyverse"); library("tidyverse")
if(!require("ggplot2")) install.packages("ggplot2"); library("ggplot2")
if(!require("phangorn")) install.packages("phangorn"); library("phangorn")
if(!require("ape")) install.packages("ape"); library("ape")
if(!require("seqinr")) install.packages("seqinr"); library("seqinr")
### input
dir_input = "5_posterior/"
in_tree = "mcc.tree"
### input tree
tree = read.tree(file = paste0(dir_input, in_tree))
### input tree
tree = read.tree(file = paste0(dir_input, in_tree))
### tips to keep
keep_names = tree$tip.label[grepl("C_", tree$tip.label)]
### prun tree
ktree = keep.tip(phy = tree,
tip = keep_names)
### output
dir_out = "5_posterior/"
out_tree = "mcc_chamaecrista.tree"
### export
write.tree(phy =  ktree,
file = paste0(dir_out, out_tree)
)
### libraries
library("ape")
library("rexpokit")
library("cladoRcpp")
library("BioGeoBEARS")
### phylogenetic tree location
trfn = "5_posterior/mcc.tree"
tr = read.tree(file = trfn)
### reading range data
geog_fn = ("6_biogeo_data/macro_biogeo.data")
moref(geog_fn)
### converting phylip format to tipranges
tipranges = getranges_from_LagrangePHYLIP(lgdata_fn=geog_fn)
tipranges
### setting maximum number of areas occupied for reconstructions
max_range_size = max(rowSums(dfnums_to_numeric(tipranges@df)))
### Initialize DEC model
dec = define_BioGeoBEARS_run()
# location of the geography text file
dec$geogfn = geog_fn
### Input the maximum range size
dec$max_range_size = max_range_size
### Min to treat tip as a direct ancestor (no speciation event)
dec$min_branchlength = 0.001
# set to FALSE for e.g. DEC* model, DEC*+J, etc.
dec$include_null_range = FALSE
### computing options
dec$num_cores_to_use = 1
### default settings to get ancestral states
dec$return_condlikes_table = TRUE
dec$calc_TTL_loglike_from_condlikes_table = TRUE
dec$calc_ancprobs = TRUE    # get ancestral states from optim run
### inputting tree into DEC
dec$trfn = trfn
### fitting DEC !
res_dec = bears_optim_run(dec)
### save fitted model
save(res_dec, file="7_biogeo_results/macro_DEC_default.Rdata")
###  biogeobears scripts
scriptdir = np(system.file("extdata/a_scripts", package="BioGeoBEARS"))
res_plot = plot_BioGeoBEARS_results(results_object= res_DEC,
addl_params=list("j"),
plotwhat="text",
label.offset=0.7,
tipcex=0.15,
statecex=0.4,
titlecex=0.8,
plotsplits= F,
cornercoords_loc= scriptdir,
include_null_range= F,
tr=tr,
tipranges=tipranges,
plotlegend = F)
res_dec
res_plot = plot_BioGeoBEARS_results(results_object= res_dec,
addl_params=list("j"),
plotwhat="text",
label.offset=0.7,
tipcex=0.15,
statecex=0.4,
titlecex=0.8,
plotsplits= F,
cornercoords_loc= scriptdir,
include_null_range= F,
tr=tr,
tipranges=tipranges,
plotlegend = F)
trfn
tr = ladderize(read.tree(file = trfn))
tr
plot(ladderize)
plot(tr)
### input
dir_input = "5_posterior/"
in_tree = "mcc.tree"
### input tree
tree = read.tree(file = paste0(dir_input, in_tree))
## ladderize
tree = ladderize(tree)
plot(trees)
plot(tree)
### tips to keep
keep_names = tree$tip.label[grepl("C_", tree$tip.label)]
### prun tree
ktree = keep.tip(phy = tree,
tip = keep_names)
### output
dir_out = "5_posterior/"
out_tree = "mcc_chamaecrista.tree"
### export
write.tree(phy =  ktree,
file = paste0(dir_out, out_tree)
)
write.tree(phy =  tree,
file = paste0(dir_out, "mcc.tree")
)
### phylogenetic tree location
trfn = "5_posterior/mcc.tree"
tr = read.tree(file = trfn)
plot(tr)
### reading range data
geog_fn = ("6_biogeo_data/macro_biogeo.data")
moref(geog_fn)
### converting phylip format to tipranges
tipranges = getranges_from_LagrangePHYLIP(lgdata_fn=geog_fn)
tipranges
### setting maximum number of areas occupied for reconstructions
max_range_size = max(rowSums(dfnums_to_numeric(tipranges@df)))
### Initialize DEC model
dec = define_BioGeoBEARS_run()
# location of the geography text file
dec$geogfn = geog_fn
### Input the maximum range size
dec$max_range_size = max_range_size
### Min to treat tip as a direct ancestor (no speciation event)
dec$min_branchlength = 0.001
# set to FALSE for e.g. DEC* model, DEC*+J, etc.
dec$include_null_range = FALSE
### computing options
dec$num_cores_to_use = 1
### default settings to get ancestral states
dec$return_condlikes_table = TRUE
dec$calc_TTL_loglike_from_condlikes_table = TRUE
dec$calc_ancprobs = TRUE    # get ancestral states from optim run
### inputting tree into DEC
dec$trfn = trfn
### fitting DEC !
res_dec = bears_optim_run(dec)
### save fitted model
save(res_dec, file="7_biogeo_results/macro_DEC_default.Rdata")
###  biogeobears scripts
scriptdir = np(system.file("extdata/a_scripts", package="BioGeoBEARS"))
res_plot = plot_BioGeoBEARS_results(results_object= res_dec,
addl_params=list("j"),
plotwhat="text",
label.offset=0.7,
tipcex=0.15,
statecex=0.4,
titlecex=0.8,
plotsplits= F,
cornercoords_loc= scriptdir,
include_null_range= F,
tr=tr,
tipranges=tipranges,
plotlegend = F)
res_plot = plot_BioGeoBEARS_results(results_object= res_dec,
addl_params=list("j"),
plotwhat="text",
label.offset=0.7,
tipcex=0.15,
statecex=0.4,
titlecex=0.8,
plotsplits= F,
cornercoords_loc= scriptdir,
include_null_range= F,
tr=tr,
tipranges=tipranges,
plotlegend = F)
### phylogenetic tree location
trfn = "5_posterior/mcc.tree"
tr = read.tree(file = trfn)
### libraries
library("ape")
library("rexpokit")
library("cladoRcpp")
library("BioGeoBEARS")
### phylogenetic tree location
trfn = "5_posterior/mcc.tree"
tr = read.tree(file = trfn)
tr
grepl("C_", tr$tip.label)
sum(grepl("C_", tr$tip.label) )
tr
330/231
231/330
